---
title: "Payload Formats"
description: "Data structure specifications for GRIPLOCK messages"
---

# Payload Formats

This document specifies the data structures used throughout GRIPLOCK for credential exchange, encryption, and blockchain interaction.

## QR Code Payload

The QR code displayed on the dashboard contains compressed connection data.

### Structure

```typescript
interface QRPayload {
  type: 'offer';
  sdp: string;           // WebRTC SDP offer
  pk: string;            // Dashboard public key (64 hex chars)
  sessionId: string;     // UUID v4
  wsUrl: string;         // WebSocket signaling endpoint
}
```

### Encoding

```typescript
// Compression pipeline
const payload: QRPayload = {
  type: 'offer',
  sdp: offer.sdp,
  pk: publicKeyToHex(keyPair.publicKey),
  sessionId: crypto.randomUUID(),
  wsUrl: `wss://${host}/ws`
};

// 1. Serialize to JSON
const json = JSON.stringify(payload);

// 2. Compress with pako (zlib)
const compressed = pako.deflate(json);

// 3. Base64 encode
const qrData = btoa(String.fromCharCode.apply(null, Array.from(compressed)));
```

### Decoding

```typescript
// 1. Base64 decode
const binary = atob(qrData);
const bytes = new Uint8Array(binary.split('').map(c => c.charCodeAt(0)));

// 2. Decompress
const json = pako.inflate(bytes, { to: 'string' });

// 3. Parse JSON
const payload: QRPayload = JSON.parse(json);
```

### Example

```json
{
  "type": "offer",
  "sdp": "v=0\r\no=- 1234567890 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\n...",
  "pk": "a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2",
  "sessionId": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "wsUrl": "wss://app.griplock.io/ws"
}
```

## Wallet Credentials

Credentials collected on the mobile device.

### Plaintext Structure

```typescript
interface WalletCredentials {
  nfcId: string;    // NFC card UID (hex string)
  pin: string;      // User PIN (numeric string)
}
```

### Example

```json
{
  "nfcId": "04A1B2C3D4E5F6",
  "pin": "123456"
}
```

### NFC UID Formats

| Type | Length | Example |
|------|--------|---------|
| Single Size | 4 bytes | `04A1B2C3` |
| Double Size | 7 bytes | `04A1B2C3D4E5F6` |
| Triple Size | 10 bytes | `04A1B2C3D4E5F6A7B8C9` |

## Encrypted Credentials

Credentials encrypted for transmission.

### Structure

```typescript
interface EncryptedCredentials {
  nonce: string;      // 24 hex chars (12 bytes)
  ciphertext: string; // Variable length hex
}
```

### Example

```json
{
  "nonce": "a1b2c3d4e5f6a7b8c9d0e1f2",
  "ciphertext": "8f9e7d6c5b4a39281706f5e4d3c2b1a0..."
}
```

### Encryption Algorithm

```typescript
// AES-256-GCM encryption
const nonce = randomBytes(12);
const aes = gcm(sharedSecret, nonce);
const ciphertext = aes.encrypt(utf8ToBytes(JSON.stringify(credentials)));

const encrypted: EncryptedCredentials = {
  nonce: bytesToHex(nonce),
  ciphertext: bytesToHex(ciphertext)
};
```

## Session Storage

Credentials stored in browser localStorage.

### Encrypted Storage Format

```typescript
interface EncryptedStorageData {
  nonce: string;       // AES-GCM nonce (hex)
  ciphertext: string;  // Encrypted payload (hex)
  expiresAt: number;   // Unix timestamp (ms)
}
```

### Decrypted Payload

```typescript
interface StoredWalletData {
  nfcId: string;       // NFC card UID
  pin: string;         // User PIN
  sessionId: string;   // Session identifier
  expiresAt: number;   // Expiration timestamp
}
```

### Example (Encrypted)

```json
{
  "nonce": "a1b2c3d4e5f6a7b8c9d0e1f2",
  "ciphertext": "8f9e7d6c5b4a...",
  "expiresAt": 1704067200000
}
```

## Solana Balance Response

Response from `getBalance` RPC call.

### Structure

```typescript
interface SolanaBalance {
  sol: number;       // Balance in SOL
  lamports: number;  // Balance in lamports (1 SOL = 10^9 lamports)
}
```

### Example

```json
{
  "sol": 1.5,
  "lamports": 1500000000
}
```

## Token Balance Response

Response from `getTokenAccountsByOwner` RPC call.

### Structure

```typescript
interface TokenBalance {
  mint: string;      // Token mint address (base58)
  symbol: string;    // Token symbol (e.g., "USDC")
  balance: number;   // Human-readable balance
  decimals: number;  // Token decimal places
}
```

### Example

```json
{
  "mint": "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",
  "symbol": "USDC",
  "balance": 100.5,
  "decimals": 6
}
```

### Known Token Mapping

```typescript
const KNOWN_TOKENS: Record<string, string> = {
  'EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v': 'USDC',
  'Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB': 'USDT',
  'So11111111111111111111111111111111111111112': 'wSOL',
  'DezXAZ8z7PnrnRJjz3wXBoRgixCa6xjnB7YaB1pPB263': 'BONK',
  'JUPyiwrYJFskUPiHa7hkeR8VUtAeFoSYbKedZNsDvCN': 'JUP'
};
```

## Transaction Response

Response from `getSignaturesForAddress` RPC call.

### Structure

```typescript
interface SolanaTransaction {
  signature: string;         // Transaction signature (base58)
  slot: number;              // Slot number
  blockTime: number | null;  // Unix timestamp (seconds)
  type: 'SEND' | 'RECEIVE' | 'UNKNOWN';
  amount?: number;           // Transaction amount (if parseable)
  otherAddress?: string;     // Counterparty address
}
```

### Example

```json
{
  "signature": "5VdY2...",
  "slot": 123456789,
  "blockTime": 1704067200,
  "type": "RECEIVE",
  "amount": 0.5,
  "otherAddress": "9WzDX..."
}
```

## Key Pair

Ephemeral keys for ECDH key exchange.

### Structure

```typescript
interface KeyPair {
  publicKey: Uint8Array;   // 32 bytes
  privateKey: Uint8Array;  // 32 bytes
}
```

### Hex Representation

```typescript
const publicKeyHex = bytesToHex(keyPair.publicKey);
// "a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2"
```

## WebRTC Session Description

Standard WebRTC SDP format.

### Structure

```typescript
interface RTCSessionDescriptionInit {
  type: 'offer' | 'answer';
  sdp: string;  // Session Description Protocol string
}
```

### Example (Truncated)

```json
{
  "type": "offer",
  "sdp": "v=0\r\no=- 8892814975220665879 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS\r\nm=application 9 UDP/DTLS/SCTP webrtc-datachannel\r\n..."
}
```

## ICE Candidate

Standard WebRTC ICE candidate format.

### Structure

```typescript
interface RTCIceCandidateInit {
  candidate: string;
  sdpMid: string | null;
  sdpMLineIndex: number | null;
}
```

### Example

```json
{
  "candidate": "candidate:1 1 UDP 2122252543 192.168.1.100 54321 typ host",
  "sdpMid": "0",
  "sdpMLineIndex": 0
}
```

## Type Definitions Summary

```typescript
// Full type exports
export type {
  QRPayload,
  WalletCredentials,
  EncryptedCredentials,
  EncryptedStorageData,
  StoredWalletData,
  SolanaBalance,
  TokenBalance,
  SolanaTransaction,
  KeyPair
};
```

## Next Steps

<CardGroup cols={2}>
  <Card title="Introduction" icon="house" href="/introduction">
    Return to documentation home
  </Card>
  <Card title="Key Derivation" icon="key" href="/security/key-derivation">
    Cryptographic derivation details
  </Card>
</CardGroup>
